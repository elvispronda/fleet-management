<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Drivers Management</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white">
<div class="flex flex-col md:flex-row h-screen overflow-hidden">
    <!-- Sidebar -->
    <script src="https://unpkg.com/lucide@latest"></script>

      <!-- Sidebar (Left) -->
    <aside class="w-64 bg-white dark:bg-gray-800/95 backdrop-blur-sm p-4 space-y-6 shadow-lg hidden md:block flex-shrink-0 border-r dark:border-gray-700">
      <div class="text-2xl font-bold flex items-center space-x-2 text-primary dark:text-primary-light">
        <i data-lucide="command" class="w-7 h-7"></i><span>FleetDash</span>
      </div>
      <nav class="flex-1">
        <ul class="space-y-2">
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-md transition-colors">
          <i data-lucide="layout-dashboard" class="w-5 h-5"></i><a href="dashboard.html">Dashboard</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-md transition-colors">
          <i data-lucide="pie-chart" class="w-5 h-5"></i><a href="analytics.html">Analytics</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-md transition-colors">
          <i data-lucide="users" class="w-5 h-5"></i><a href="users.html">User</a>
        </li>
        <li class="flex items-center space-x-3 text-blue-600 dark:text-blue-400 font-semibold bg-blue-50 dark:bg-gray-700 p-2 rounded-md transition-colors">
          <i data-lucide="user" class="w-5 h-5"></i><a href="driver.html">Driver</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-md transition-colors">
          <i data-lucide="alert-triangle" class="w-5 h-5"></i><a href="panne.html">Pannes (Issues)</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-md transition-colors">
          <i data-lucide="car" class="w-5 h-5"></i><a href="vehicle.html">Vehicles</a>
        </li>
         <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-md transition-colors">
          <i data-lucide="wrench" class="w-5 h-5"></i><a href="reparation.html">Reparation</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-md transition-colors">
          <i data-lucide="droplet" class="w-5 h-5"></i><a href="fuel.html">Fuel</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-md transition-colors">
          <i data-lucide="settings" class="w-5 h-5"></i><a href="maintenance.html">Maintenance</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 p-2 rounded-md transition-colors">
          <i data-lucide="route" class="w-5 h-5"></i><a href="trip.html">Trip</a>
        </li>
      </ul>
      </nav>
       <div class="pt-4 border-t border-gray-200 dark:border-gray-700/50 mt-auto">
            <a href="#" id="global-logout-btn" class="flex items-center space-x-3 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700/40 p-2.5 rounded-lg transition-colors">
                <i data-lucide="log-out" class="w-5 h-5"></i><span>Logout</span>
            </a>
       </div>
    </aside>
    
    <!-- Call Lucide to load icons -->
    <script>
      lucide.createIcons();
    </script>

  <!-- Main content -->
  <main class="flex-1 overflow-auto p-6">
    <!-- Drivers Table Section -->
    <section id="drivers" class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow mb-6">
      <div class="flex flex-col sm:flex-row justify-between items-center mb-3 gap-2">
        <h3 class="text-xl font-bold">Drivers Management</h3>
        <div class="flex flex-wrap gap-2 items-center">
          <button onclick="openAddDriverModal()" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 flex items-center gap-1">
            <i data-lucide="plus" class="w-4 h-4"></i> Add Driver
          </button>
          <input type="text" id="driverSearch" placeholder="Search drivers..." class="border rounded px-2 py-1 text-sm text-black">
          <button onclick="exportDriversExcel()" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">ðŸ“„ Excel</button>
          <button onclick="exportDriversPDF()" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">ðŸ§¾ PDF</button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table id="driversTable" class="w-full text-left text-sm">
          <thead>
            <tr class="border-b dark:border-gray-700">
              <th class="py-2">ID</th>
              <th>Last Name</th>
              <th>First Name</th>
              <th>CNI</th>
              <th>Email</th>
              <th>Matricule</th>
              <th>Created At</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="driversBody"></tbody>
        </table>
      </div>
      <div class="mt-4 flex justify-between items-center">
        <div class="text-sm text-gray-500 dark:text-gray-400" id="driversCount"></div>
        <div class="flex space-x-2" id="driversPagination"></div>
      </div>
    </section>

    <!-- Statistics -->
    <section id="statistics" class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow">
      <h3 class="text-xl font-bold mb-2">Statistics</h3>
      <div class="flex flex-col md:flex-row md:space-x-4">
        <div class="w-full md:w-1/2">
          <h4 class="text-md font-semibold mb-1">Driver Growth</h4>
          <canvas id="lineChart" class="w-full h-64"></canvas>
        </div>
        <div class="w-full md:w-1/2 mt-4 md:mt-0">
          <h4 class="text-md font-semibold mb-1">Driver Distribution</h4>
          <canvas id="pieChart" class="mx-auto" style="width: 200px; height: 300px;"></canvas>
        </div>
      </div>
    </section>
  </main>

    <!-- Right Sidebar -->
    <aside class="w-1/5 bg-white dark:bg-gray-800 p-4 space-y-6 shadow-md hidden lg:block">
        <div class="flex justify-between items-center">
        <button id="theme-toggle" class="text-xl">ðŸŒ™</button>
        <div>
            <div class="text-sm font-semibold">John Doe</div>
            <div class="text-xs text-gray-500 dark:text-gray-300">Admin</div>
        </div>
        </div>

        <!-- Recent Updates -->
        <div>
        <h4 class="font-bold mb-4 text-lg">Recent Updates</h4>
        <div class="flex flex-col space-y-6 relative">
            <div class="absolute left-5 top-0 bottom-0 w-0.5 bg-blue-500"></div>

            <div class="flex items-start space-x-4 relative">
            <div class="w-3 h-3 bg-blue-500 rounded-full z-10 mt-1.5 ml-4"></div>
            <div class="ml-2">
                <p class="font-medium">New driver registered</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">5 minutes ago</p>
            </div>
            </div>

            <div class="flex items-start space-x-4 relative">
            <div class="w-3 h-3 bg-blue-500 rounded-full z-10 mt-1.5 ml-4"></div>
            <div class="ml-2">
                <p class="font-medium">System updated</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">15 minutes ago</p>
            </div>
            </div>

            <div class="flex items-start space-x-4 relative">
            <div class="w-3 h-3 bg-blue-500 rounded-full z-10 mt-1.5 ml-4"></div>
            <div class="ml-2">
                <p class="font-medium">Security alert</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">1 hour ago</p>
            </div>
            </div>
        </div>
        </div>

        <!-- Quick Actions -->
        <div class="mt-8">
        <h4 class="font-bold mb-4 text-lg">Quick Actions</h4>
        <div class="grid grid-cols-2 gap-2">
            <button class="p-2 bg-gray-100 dark:bg-gray-700 rounded-lg flex flex-col items-center">
            <i data-lucide="user-plus" class="w-5 h-5 mb-1"></i>
            <span class="text-xs">Add Driver</span>
            </button>
            <button class="p-2 bg-gray-100 dark:bg-gray-700 rounded-lg flex flex-col items-center">
            <i data-lucide="settings" class="w-5 h-5 mb-1"></i>
            <span class="text-xs">Settings</span>
            </button>
            <button class="p-2 bg-gray-100 dark:bg-gray-700 rounded-lg flex flex-col items-center">
            <i data-lucide="help-circle" class="w-5 h-5 mb-1"></i>
            <span class="text-xs">Help</span>
            </button>
            <button class="p-2 bg-gray-100 dark:bg-gray-700 rounded-lg flex flex-col items-center">
            <i data-lucide="log-out" class="w-5 h-5 mb-1"></i>
            <span class="text-xs">Logout</span>
            </button>
        </div>
        </div>
    </aside>
</div>

<!-- Add Driver Modal -->
<div id="addDriverModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 hidden">
  <div class="modal-content bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md">
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <div>
          <h3 class="text-xl font-bold text-gray-800 dark:text-white">Add New Driver</h3>
          <p class="text-sm text-gray-500 dark:text-gray-400">Fill in the driver details below</p>
        </div>
        <button onclick="closeAddDriverModal()" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
          <i data-lucide="x" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
        </button>
      </div>
      
      <form id="addDriverForm" class="space-y-4">
        <div>
          <label for="nom" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Last Name</label>
          <input type="text" id="nom" required 
                 class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700"
                 placeholder="Doe">
        </div>
        
        <div>
          <label for="prenom" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">First Name</label>
          <input type="text" id="prenom" required 
                 class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700"
                 placeholder="John">
        </div>
        
        <div>
          <label for="cni" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">CNI Number</label>
          <input type="text" id="cni" required 
                 class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700"
                 placeholder="1234567890">
        </div>
        
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email</label>
          <input type="email" id="email" required 
                 class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700"
                 placeholder="driver@example.com">
        </div>
        
        <div>
          <label for="matricule" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Matricule</label>
          <input type="text" id="matricule" required 
                 class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700"
                 placeholder="DRV001">
        </div>
        
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" onclick="closeAddDriverModal()" 
                  class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
            Cancel
          </button>
          <button type="submit" 
                  class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg flex items-center gap-2">
            <i data-lucide="user-plus" class="w-4 h-4"></i>
            Add Driver
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmDeleteModal" class="modal fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 hidden">
  <div class="modal-content bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md">
    <div class="p-6">
      <div class="flex justify-between items-center mb-6">
        <div>
          <h3 class="text-xl font-bold text-gray-800 dark:text-white">Confirm Deletion</h3>
          <p class="text-sm text-gray-500 dark:text-gray-400">Are you sure you want to delete this driver?</p>
        </div>
        <button onclick="closeConfirmDeleteModal()" class="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
          <i data-lucide="x" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
        </button>
      </div>
      
      <div class="flex justify-end gap-3 pt-4">
        <button onclick="closeConfirmDeleteModal()" 
                class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
          Cancel
        </button>
        <button id="confirmDeleteBtn" 
                class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg flex items-center gap-2">
          <i data-lucide="trash-2" class="w-4 h-4"></i>
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  // Global variables for drivers table
  let allDrivers = [];
  const driversPerPage = 5;
  let currentDriversPage = 1;
  let driverToDelete = null;
  
  // Check authentication on page load
  document.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('access_token');
      if (!token) {
          window.location.href = '/login';
          return;
      }
      fetchDrivers();
      initCharts();
  });
  
  // Fetch drivers from API
  async function fetchDrivers() {
      try {
          const token = localStorage.getItem('access_token');
          const response = await fetch('/driver/', {
              headers: {
                  'Authorization': `Bearer ${token}`,
                  'Content-Type': 'application/json'
              }
          });
  
          if (response.status === 401) {
              localStorage.removeItem('access_token');
              window.location.href = '/login';
              return;
          }
  
          if (!response.ok) {
              throw new Error('Failed to fetch drivers');
          }
  
          allDrivers = await response.json();
          renderDriversTable();
      } catch (error) {
          console.error('Error:', error);
          alert('Error loading drivers. Please try again.');
      }
  }
  
  // Render drivers table
  function renderDriversTable() {
      const searchTerm = document.getElementById('driverSearch').value.toLowerCase();
      const filteredDrivers = allDrivers.filter(driver => 
          driver.nom.toLowerCase().includes(searchTerm) || 
          driver.prenom.toLowerCase().includes(searchTerm) ||
          driver.cni.toLowerCase().includes(searchTerm) ||
          driver.email.toLowerCase().includes(searchTerm) ||
          driver.matricule.toLowerCase().includes(searchTerm)
      );
  
      const start = (currentDriversPage - 1) * driversPerPage;
      const paginatedDrivers = filteredDrivers.slice(start, start + driversPerPage);
  
      const driversBody = document.getElementById('driversBody');
      driversBody.innerHTML = paginatedDrivers.length > 0 ? 
          paginatedDrivers.map(driver => `
              <tr class="border-b dark:border-gray-700" data-id="${driver.id}">
                  <td class="py-2">${driver.id}</td>
                  <td>${driver.nom}</td>
                  <td>${driver.prenom}</td>
                  <td>${driver.cni}</td>
                  <td>${driver.email}</td>
                  <td>${driver.matricule}</td>
                  <td>${new Date(driver.created_at).toLocaleString()}</td>
                  <td>
                      <button class="text-blue-500 hover:underline mr-2">Edit</button>
                      <button onclick="openConfirmDeleteModal(${driver.id})" class="text-red-500 hover:underline">Delete</button>
                  </td>
              </tr>
          `).join('') : 
          `<tr><td colspan="8" class="text-center py-4">No drivers found</td></tr>`;
  
      // Update count display
      document.getElementById('driversCount').textContent = 
          `Showing ${start + 1}-${Math.min(start + driversPerPage, filteredDrivers.length)} of ${filteredDrivers.length} drivers`;
  
      // Render pagination
      const totalPages = Math.ceil(filteredDrivers.length / driversPerPage);
      const paginationContainer = document.getElementById('driversPagination');
      paginationContainer.innerHTML = '';
      
      // Previous button
      if (currentDriversPage > 1) {
          paginationContainer.innerHTML += `
              <button onclick="currentDriversPage=${currentDriversPage - 1};renderDriversTable();" 
                      class="px-3 py-1 rounded bg-gray-200 dark:bg-gray-700">
                  Previous
              </button>
          `;
      }
      
      // Page numbers
      const maxVisiblePages = 5;
      let startPage = Math.max(1, currentDriversPage - Math.floor(maxVisiblePages / 2));
      let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
      
      if (endPage - startPage + 1 < maxVisiblePages) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
      }
      
      for (let i = startPage; i <= endPage; i++) {
          paginationContainer.innerHTML += `
              <button onclick="currentDriversPage=${i};renderDriversTable();" 
                      class="px-3 py-1 rounded ${i === currentDriversPage ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-700'}">
                  ${i}
              </button>
          `;
      }
      
      // Next button
      if (currentDriversPage < totalPages) {
          paginationContainer.innerHTML += `
              <button onclick="currentDriversPage=${currentDriversPage + 1};renderDriversTable();" 
                      class="px-3 py-1 rounded bg-gray-200 dark:bg-gray-700">
                  Next
              </button>
          `;
      }
  }
  
  // Search functionality for drivers
  document.getElementById('driverSearch').addEventListener('input', () => {
      currentDriversPage = 1;
      renderDriversTable();
  });

  // Modal functions
  function openAddDriverModal() {
    const modal = document.getElementById('addDriverModal');
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }
  
  function closeAddDriverModal() {
    const modal = document.getElementById('addDriverModal');
    modal.classList.add('hidden');
    document.body.style.overflow = '';
  }
  
  // Delete confirmation modal functions
  function openConfirmDeleteModal(driverId) {
    driverToDelete = driverId;
    const modal = document.getElementById('confirmDeleteModal');
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }
  
  function closeConfirmDeleteModal() {
    driverToDelete = null;
    const modal = document.getElementById('confirmDeleteModal');
    modal.classList.add('hidden');
    document.body.style.overflow = '';
  }
  
  // Handle delete confirmation
  document.getElementById('confirmDeleteBtn').addEventListener('click', async function() {
    if (!driverToDelete) return;
    
    try {
      const token = localStorage.getItem('access_token');
      const response = await fetch(`/driver/${driverToDelete}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });
      
      if (response.status === 401) {
        localStorage.removeItem('access_token');
        window.location.href = '/login';
        return;
      }
      
      if (!response.ok) {
        throw new Error('Failed to delete driver');
      }
      
      // Remove the driver from the local array
      allDrivers = allDrivers.filter(driver => driver.id !== driverToDelete);
      
      // Close the modal
      closeConfirmDeleteModal();
      
      // Refresh the table
      currentDriversPage = 1;
      renderDriversTable();
      
      // Show success message
      alert('Driver deleted successfully!');
      
    } catch (error) {
      console.error('Error:', error);
      alert('Error deleting driver. Please try again.');
    }
  });

  // Close modals when clicking outside
  document.getElementById('addDriverModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeAddDriverModal();
    }
  });

  document.getElementById('confirmDeleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeConfirmDeleteModal();
    }
  });

  // Form submission
  document.getElementById('addDriverForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const nom = document.getElementById('nom').value;
    const prenom = document.getElementById('prenom').value;
    const cni = document.getElementById('cni').value;
    const email = document.getElementById('email').value;
    const matricule = document.getElementById('matricule').value;
    
    try {
      const token = localStorage.getItem('access_token');
      const response = await fetch('/driver/', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          nom,
          prenom,
          cni,
          email,
          matricule
        })
      });
      
      if (!response.ok) {
        throw new Error('Failed to add driver');
      }
      
      const newDriver = await response.json();
      allDrivers.unshift(newDriver);
      
      // Reset form and close modal
      document.getElementById('addDriverForm').reset();
      closeAddDriverModal();
      
      // Refresh the table
      currentDriversPage = 1;
      renderDriversTable();
      
      // Show success message
      alert('Driver added successfully!');
      
    } catch (error) {
      console.error('Error:', error);
      alert('Error adding driver. Please try again.');
    }
  });

  // Export functions for drivers
  function exportDriversExcel() {
      const searchTerm = document.getElementById('driverSearch').value.toLowerCase();
      const filteredDrivers = allDrivers.filter(driver => 
          driver.nom.toLowerCase().includes(searchTerm) || 
          driver.prenom.toLowerCase().includes(searchTerm) ||
          driver.cni.toLowerCase().includes(searchTerm) ||
          driver.email.toLowerCase().includes(searchTerm) ||
          driver.matricule.toLowerCase().includes(searchTerm)
      );

      // Create a worksheet
      const ws = XLSX.utils.json_to_sheet(filteredDrivers.map(driver => ({
          ID: driver.id,
          'Last Name': driver.nom,
          'First Name': driver.prenom,
          'CNI': driver.cni,
          'Email': driver.email,
          'Matricule': driver.matricule,
          'Created At': new Date(driver.created_at).toLocaleString()
      })));

      // Create a workbook
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Drivers");

      // Export to Excel file
      XLSX.writeFile(wb, "drivers_export.xlsx");
  }

  function exportDriversPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Title
      doc.setFontSize(18);
      doc.text('Drivers List', 14, 15);

      // Table headers
      const headers = [['ID', 'Last Name', 'First Name', 'CNI', 'Email', 'Matricule', 'Created At']];
      const data = allDrivers.map(driver => [
          driver.id,
          driver.nom,
          driver.prenom,
          driver.cni,
          driver.email,
          driver.matricule,
          new Date(driver.created_at).toLocaleString()
      ]);

      // Add table
      doc.autoTable({
          head: headers,
          body: data,
          startY: 25,
          theme: 'grid',
          headStyles: {
              fillColor: [59, 130, 246],
              textColor: 255
          }
      });

      doc.save('drivers_export.pdf');
  }

  // Initialize charts
  function initCharts() {
    // Line chart
    const lineCtx = document.getElementById('lineChart').getContext('2d');
    new Chart(lineCtx, {
      type: 'line',
      data: {
        labels: ['January', 'February', 'March', 'April', 'May', 'June','July', 'August', 'september', 'October', 'November','December'],
        datasets: [
          {
            label: 'New Drivers',
            data: [2, 5, 8, 10, 12, 15],
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.2)',
            fill: true,
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: true },
          tooltip: { enabled: true }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    // Pie chart - Example with some dummy data
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    
    new Chart(pieCtx, {
      type: 'pie',
      data: {
        labels: ['Active', 'On Leave', 'Inactive'],
        datasets: [{
          data: [12, 3, 2],
          backgroundColor: [
            'rgba(16, 185, 129, 0.8)',
            'rgba(245, 158, 11, 0.8)',
            'rgba(239, 68, 68, 0.8)'
          ],
          borderColor: [
            'rgba(16, 185, 129, 1)',
            'rgba(245, 158, 11, 1)',
            'rgba(239, 68, 68, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    });
  }

  // Theme toggle
  document.getElementById('theme-toggle').addEventListener('click', () => {
    document.documentElement.classList.toggle('dark');
  });
</script>
</body>
</html>