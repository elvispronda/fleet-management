<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enhanced Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white">
<div class="flex flex-col md:flex-row h-screen overflow-hidden">
    <!-- Sidebar -->
    <!-- Add Lucide Icons CDN in <head> if not already -->
    <script src="https://unpkg.com/lucide@latest"></script>


    <aside class="w-64 bg-white dark:bg-gray-800 p-4 space-y-6 shadow-md hidden md:block">
      <div class="text-xl font-bold flex items-center space-x-2">
        <i data-lucide="menu" class="w-5 h-5"></i><span>Menu</span>
      </div>
      <ul class="space-y-4">
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-blue-600">
          <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
          <a href="dashboard">Dashboard</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-blue-600">
          <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
          <a href="analytics">Analytics</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-blue-600">
          <i data-lucide="car" class="w-5 h-5"></i>
          <a href="vehicle">Vehicles</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-blue-600">
          <i data-lucide="user" class="w-5 h-5"></i>
          <a href="user">Drivers</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-blue-600">
          <i data-lucide="wrench" class="w-5 h-5"></i>
          <a href="reparation">Reparation</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-blue-600">
          <i data-lucide="droplet" class="w-5 h-5"></i>
          <a href="fuel">Fuel</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-blue-600">
          <i data-lucide="settings" class="w-5 h-5"></i>
          <a href="maintenance">Maintenance</a>
        </li>
        <li class="flex items-center space-x-3 text-gray-700 dark:text-gray-300 hover:text-blue-600">
          <i data-lucide="route" class="w-5 h-5"></i>
          <a href="trip">Trip</a>
        </li>
      </ul>
    </aside>
    
    <!-- Call Lucide to load icons -->
    <script>
      lucide.createIcons();
    </script>

  <!-- Main content -->
  <main class="flex-1 overflow-auto p-6">
    <!-- Users Table Section -->
    <section id="users" class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow mb-6">
      <div class="flex flex-col sm:flex-row justify-between items-center mb-3 gap-2">
        <h3 class="text-xl font-bold">Users Management</h3>
        <div class="flex flex-wrap gap-2 items-center">
          <input type="text" id="userSearch" placeholder="Search users..." class="border rounded px-2 py-1 text-sm text-black">
          <button onclick="exportUsersExcel()" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">ðŸ“„ Excel</button>
          <button onclick="exportUsersPDF()" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">ðŸ§¾ PDF</button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table id="usersTable" class="w-full text-left text-sm">
          <thead>
            <tr class="border-b dark:border-gray-700">
              <th class="py-2">ID</th>
              <th>Email</th>
              <th>Username</th>
              <th>Created At</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="usersBody"></tbody>
        </table>
      </div>
      <div class="mt-4 flex justify-center space-x-2" id="usersPagination"></div>
    </section>

    <!-- Rest of your existing content (statistics, reports, etc.) -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <!-- Your existing cards -->
    </div>

    <!-- Statistics -->
    <section id="statistics" class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow">
      <!-- Your existing charts -->
    </section>

    <!-- Reports Section -->
    <section id="reports" class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow">
      <!-- Your existing reports table -->
    </section>
  </main>

    <!-- Right Sidebar -->
    <!-- Your existing right sidebar content -->
</div>

<!-- Charts and Table Script -->
<script>
  // Users Table Functionality
  const usersPerPage = 5;
  let currentUsersPage = 1;
  let allUsers = [];

  // Fetch users from your FastAPI endpoint
  async function fetchUsers() {
    try {
      const token = localStorage.getItem('access_token');
      if (!token) {
        window.location.href = '/login';
        return;
      }

      const response = await fetch('/user/', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (!response.ok) {
        throw new Error('Failed to fetch users');
      }

      allUsers = await response.json();
      renderUsersTable();
    } catch (error) {
      console.error('Error fetching users:', error);
      alert(error.message);
    }
  }

  function renderUsersTable() {
    const searchTerm = document.getElementById('userSearch').value.toLowerCase();
    const filteredUsers = allUsers.filter(user => 
      user.email.toLowerCase().includes(searchTerm) || 
      (user.username && user.username.toLowerCase().includes(searchTerm))
    );

    const start = (currentUsersPage - 1) * usersPerPage;
    const paginatedUsers = filteredUsers.slice(start, start + usersPerPage);

    const usersBody = document.getElementById('usersBody');
    usersBody.innerHTML = paginatedUsers.map(user => `
      <tr class="border-b dark:border-gray-700">
        <td class="py-2">${user.id}</td>
        <td>${user.email}</td>
        <td>${user.username || 'N/A'}</td>
        <td>${new Date(user.created_at).toLocaleString()}</td>
        <td>
          <button class="text-blue-500 hover:underline mr-2" onclick="editUser(${user.id})">Edit</button>
          <button class="text-red-500 hover:underline" onclick="deleteUser(${user.id})">Delete</button>
        </td>
      </tr>
    `).join('');

    const totalPages = Math.ceil(filteredUsers.length / usersPerPage);
    const pagination = document.getElementById('usersPagination');
    pagination.innerHTML = Array.from({ length: totalPages }, (_, i) => `
      <button class="px-2 py-1 rounded ${i + 1 === currentUsersPage ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-700'}"
        onclick="currentUsersPage=${i + 1};renderUsersTable();">${i + 1}</button>
    `).join('');
  }

  function exportUsersExcel() {
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.json_to_sheet(allUsers.map(user => ({
      ID: user.id,
      Email: user.email,
      Username: user.username || 'N/A',
      'Created At': new Date(user.created_at).toLocaleString()
    })));
    XLSX.utils.book_append_sheet(wb, ws, 'Users');
    XLSX.writeFile(wb, 'users.xlsx');
  }

  async function exportUsersPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Users Report", 10, 10);
    allUsers.slice(0, 50).forEach((user, i) => {
      doc.text(`${user.id} - ${user.email} - ${user.username || 'N/A'} - ${new Date(user.created_at).toLocaleString()}`, 10, 20 + i * 6);
    });
    doc.save('users.pdf');
  }

  function editUser(userId) {
    // Implement edit functionality
    console.log('Edit user:', userId);
    alert(`Edit user ${userId} functionality would go here`);
  }

  async function deleteUser(userId) {
    if (confirm('Are you sure you want to delete this user?')) {
      try {
        const token = localStorage.getItem('access_token');
        const response = await fetch(`/user/${userId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (response.ok) {
          alert('User deleted successfully');
          fetchUsers(); // Refresh the table
        } else {
          throw new Error('Failed to delete user');
        }
      } catch (error) {
        console.error('Error deleting user:', error);
        alert(error.message);
      }
    }
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    fetchUsers();
    document.getElementById('userSearch').addEventListener('input', () => {
      currentUsersPage = 1;
      renderUsersTable();
    });
  });

  // Your existing chart and other scripts...
</script>
</body>
</html>







